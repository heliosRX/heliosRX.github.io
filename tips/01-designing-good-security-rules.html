<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Designing Good Security Rules | heliosRX (v0.2.1)</title>
    <meta name="description" content="Examples of useful vuepress code">
    <link rel="icon" href="/logo-small.png">
    
    <link rel="preload" href="/assets/css/0.styles.8ab8f5b5.css" as="style"><link rel="preload" href="/assets/js/app.0be408bf.js" as="script"><link rel="preload" href="/assets/js/2.966b6269.js" as="script"><link rel="preload" href="/assets/js/36.ea3e45dd.js" as="script"><link rel="prefetch" href="/assets/js/10.68ebee34.js"><link rel="prefetch" href="/assets/js/11.c33e2463.js"><link rel="prefetch" href="/assets/js/12.058cc307.js"><link rel="prefetch" href="/assets/js/13.5f7b540c.js"><link rel="prefetch" href="/assets/js/14.da4148bb.js"><link rel="prefetch" href="/assets/js/15.c38f61d4.js"><link rel="prefetch" href="/assets/js/16.8e83ec1a.js"><link rel="prefetch" href="/assets/js/17.4345f684.js"><link rel="prefetch" href="/assets/js/18.f3c39895.js"><link rel="prefetch" href="/assets/js/19.dd3fabc2.js"><link rel="prefetch" href="/assets/js/20.958fb565.js"><link rel="prefetch" href="/assets/js/21.bac925e4.js"><link rel="prefetch" href="/assets/js/22.aca57d2c.js"><link rel="prefetch" href="/assets/js/23.67713607.js"><link rel="prefetch" href="/assets/js/24.c152bc98.js"><link rel="prefetch" href="/assets/js/25.d729bbc7.js"><link rel="prefetch" href="/assets/js/26.cd5f0d0a.js"><link rel="prefetch" href="/assets/js/27.fe0538f7.js"><link rel="prefetch" href="/assets/js/28.83b8bff5.js"><link rel="prefetch" href="/assets/js/29.e14d4786.js"><link rel="prefetch" href="/assets/js/3.1f8eeeab.js"><link rel="prefetch" href="/assets/js/30.925ce862.js"><link rel="prefetch" href="/assets/js/31.7eb01a1f.js"><link rel="prefetch" href="/assets/js/32.ab44ace2.js"><link rel="prefetch" href="/assets/js/33.0c1f21a4.js"><link rel="prefetch" href="/assets/js/34.b32accd1.js"><link rel="prefetch" href="/assets/js/35.28fb5152.js"><link rel="prefetch" href="/assets/js/37.496aa8fd.js"><link rel="prefetch" href="/assets/js/38.9addab41.js"><link rel="prefetch" href="/assets/js/39.956154e4.js"><link rel="prefetch" href="/assets/js/4.77d83842.js"><link rel="prefetch" href="/assets/js/40.9012c561.js"><link rel="prefetch" href="/assets/js/41.d8b98aa5.js"><link rel="prefetch" href="/assets/js/42.c23f3380.js"><link rel="prefetch" href="/assets/js/43.5ba3f141.js"><link rel="prefetch" href="/assets/js/44.70df77bd.js"><link rel="prefetch" href="/assets/js/5.97b5b921.js"><link rel="prefetch" href="/assets/js/6.f0530b27.js"><link rel="prefetch" href="/assets/js/7.6c95c193.js"><link rel="prefetch" href="/assets/js/8.baf1d434.js"><link rel="prefetch" href="/assets/js/9.f5b2cebf.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8ab8f5b5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo-small.png" alt="heliosRX (v0.2.1)" class="logo"> <span class="site-name can-hide">heliosRX (v0.2.1)</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/01-intro.html" class="nav-link">Guide</a></div><div class="nav-item"><a href="/api/" class="nav-link">API</a></div><div class="nav-item"><a href="/tips/01-designing-good-security-rules.html" class="nav-link router-link-exact-active router-link-active">Tips</a></div> <a href="https://github.com/heliosRX/heliosRX" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/01-intro.html" class="nav-link">Guide</a></div><div class="nav-item"><a href="/api/" class="nav-link">API</a></div><div class="nav-item"><a href="/tips/01-designing-good-security-rules.html" class="nav-link router-link-exact-active router-link-active">Tips</a></div> <a href="https://github.com/heliosRX/heliosRX" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Firebase Security Rules</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tips/01-designing-good-security-rules.html" class="active sidebar-link">Designing Good Security Rules</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tips/01-designing-good-security-rules.html#nested-data" class="sidebar-link">Nested data</a></li><li class="sidebar-sub-header"><a href="/tips/01-designing-good-security-rules.html#flat-de-normalized-data" class="sidebar-link">Flat / de-normalized data</a></li><li class="sidebar-sub-header"><a href="/tips/01-designing-good-security-rules.html#multi-id-key" class="sidebar-link">Multi-ID-Key</a></li><li class="sidebar-sub-header"><a href="/tips/01-designing-good-security-rules.html#time-sectioned" class="sidebar-link">Time sectioned</a></li><li class="sidebar-sub-header"><a href="/tips/01-designing-good-security-rules.html#data-duplication" class="sidebar-link">Data duplication</a></li></ul></li><li><a href="/tips/02-lessons-learned.html" class="sidebar-link">Lessons learned</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/tips/03-bolt-cheat-sheet.html" class="sidebar-link">Bolt Cheat Sheet</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/tips/04-security-rules-tips.html" class="sidebar-link">Tips for writing Security Rules</a></li><li><a href="/tips/05-how-to-debug-security-rules.html" class="sidebar-link">How to debug Security Rules</a></li><li><a href="/tips/06-database-design.html" class="sidebar-link">Considerations when designing a database</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tips/06-database-design.html#database-structure" class="sidebar-link">Database structure</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Migration</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tips/migration/future.html" class="sidebar-link">Future</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tips/migration/future.html#add-heliosrx-to-your-main-js" class="sidebar-link">Add heliosRX to your main.js</a></li><li class="sidebar-sub-header"><a href="/tips/migration/future.html#use-heliosrx-with-existing-vuex-store" class="sidebar-link">Use heliosRX with existing Vuex Store</a></li></ul></li><li><a href="/tips/migration/migration-1.html" class="sidebar-link">Migrating from v0.1 to v1.0</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="designing-good-security-rules"><a href="#designing-good-security-rules" class="header-anchor">#</a> Designing Good Security Rules</h1> <p>Let's say we want to save messages in groups. There is different ways how this can be archived with Firebase Realtime Database.
The following list gives an overview of the pro's and con's of each approach.</p> <p>Good Design requires that you think about how your data will be used in advance!
Each apprach has different pro's and con's regarding flexbility, security rules, amount of data traffic, amount of stored data,
complexity of client, sharding.</p> <h2 id="nested-data"><a href="#nested-data" class="header-anchor">#</a> Nested data</h2> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token operator">/</span>group<span class="token operator">/</span><span class="token punctuation">{</span>groupId<span class="token punctuation">}</span><span class="token operator">/</span>message<span class="token operator">/</span><span class="token punctuation">{</span>messageId<span class="token punctuation">}</span> <span class="token keyword">is</span> <span class="token punctuation">{</span>
  createdAt<span class="token punctuation">:</span> ServerTimestamp<span class="token punctuation">,</span>
  title<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>Advantage</strong>:</p> <ul><li>Simple data fetching / subscription (<code>$models.group.subscribeNode(groupId)</code>) = fast</li> <li>Server only has to manage one subscription</li> <li>Simple security rules (just grant access to <code>/group/{groupId}</code>)</li></ul> <p><strong>Disadvantage</strong>:</p> <ul><li>Grant access to single message complicated</li> <li>We have to know <code>groupId</code></li></ul> <h2 id="flat-de-normalized-data"><a href="#flat-de-normalized-data" class="header-anchor">#</a> Flat / de-normalized data</h2> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token operator">/</span>group<span class="token operator">/</span><span class="token punctuation">{</span>groupId<span class="token punctuation">}</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token operator">/</span>message<span class="token operator">/</span><span class="token punctuation">{</span>messageId<span class="token punctuation">}</span> <span class="token keyword">is</span> <span class="token punctuation">{</span>
  createdAt<span class="token punctuation">:</span> ServerTimestamp<span class="token punctuation">,</span>
  groupId<span class="token punctuation">:</span> PushId<span class="token punctuation">,</span>
  title<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>Advantage</strong>:</p> <ul><li>Less nested data</li> <li>Sharding friendly</li> <li>Easy sharing of access to data between groups</li></ul> <p><strong>Disadvantage</strong>:</p> <ul><li>We have to do a <code>subscribeQuery</code></li> <li>We'll loose one sort key, filtering by another criteria is not possible anymore (e.g. give me all messages from group X, that are also newer then date Y).</li></ul> <h2 id="multi-id-key"><a href="#multi-id-key" class="header-anchor">#</a> Multi-ID-Key</h2> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token operator">/</span>message<span class="token operator">/</span><span class="token punctuation">{</span>groupId<span class="token operator">-</span>messageId<span class="token punctuation">}</span><span class="token operator">/</span> <span class="token keyword">is</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
</code></pre></div><p><strong>Advantage</strong>:</p> <ul><li>Multiple sort keys possible (more then 2)</li></ul> <p><strong>Disadvantage</strong>:</p> <ul><li>Sorting must be defined a priori</li></ul> <h2 id="time-sectioned"><a href="#time-sectioned" class="header-anchor">#</a> Time sectioned</h2> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token operator">/</span>group<span class="token operator">/</span><span class="token punctuation">{</span>groupId<span class="token punctuation">}</span><span class="token operator">/</span>year<span class="token operator">/</span><span class="token punctuation">{</span>year<span class="token punctuation">}</span><span class="token operator">/</span>message<span class="token operator">/</span><span class="token punctuation">{</span>messageId<span class="token punctuation">}</span> <span class="token keyword">is</span> <span class="token punctuation">{</span>
  title<span class="token punctuation">:</span> String
<span class="token punctuation">}</span>
</code></pre></div><p><strong>Advantage</strong>:</p> <ul><li>Easy fetching of time sections</li> <li>Easy archives of old data (just grab <code>/group/{groupId}/year/2019</code>, dump to json and delete node)</li></ul> <p><strong>Disadvantage</strong>:</p> <ul><li>Loading multiple years requires multiple subscriptions</li> <li>Difficult to manage time ranges (e.g. show years 2010 to 2020)</li></ul> <h2 id="data-duplication"><a href="#data-duplication" class="header-anchor">#</a> Data duplication</h2> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token operator">/</span>group<span class="token operator">/</span><span class="token punctuation">{</span>groupId<span class="token punctuation">}</span><span class="token operator">/</span>message<span class="token operator">/</span><span class="token punctuation">{</span>messageId<span class="token punctuation">}</span> <span class="token keyword">is</span> <span class="token punctuation">{</span>
  cachedCreatedAt<span class="token punctuation">:</span> ServerTimestamp<span class="token punctuation">,</span>
  cachedTitle<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token operator">/</span>message<span class="token operator">/</span><span class="token punctuation">{</span>messageId<span class="token punctuation">}</span> <span class="token keyword">is</span> <span class="token punctuation">{</span>
  createdAt<span class="token punctuation">:</span> ServerTimestamp<span class="token punctuation">,</span>
  groupId<span class="token punctuation">:</span> PushId<span class="token punctuation">,</span>
  title<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>Advantage</strong>:</p> <ul><li>Best of approach 1 and 2 (one subscription/fast data + easy sharing/sharding)</li></ul> <p><strong>Disadvantage</strong>:</p> <ul><li>Managing data in two places</li> <li>Data can become inconsistent</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/tips/02-lessons-learned.html">Lessons learned</a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0be408bf.js" defer></script><script src="/assets/js/2.966b6269.js" defer></script><script src="/assets/js/36.ea3e45dd.js" defer></script>
  </body>
</html>
